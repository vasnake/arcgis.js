// Generated by CoffeeScript 1.6.3
/*
Mapedit app classes.
Author: vasnake@gmail.com
*/


(function() {
  var vappFactory;

  console.log("meapp enter");

  if (typeof vappFactory !== "undefined" && vappFactory !== null) {
    alert("vappFactory defined already!");
  } else {
    vappFactory = {};
  }

  define(["dojo/_base/declare", "dojo/dom", 'dojo/has', "vs/mpvlib"], function(declare, dom, has, mpvlib) {
    console.log('meapp dojo/define. define app classes');
    try {
      vslib.log('try vslib');
    } catch (_error) {
      window.vslib = new mpvlib();
    }
    vslib.log('vs.mpvlib declare vappFactory');
    vappFactory = {
      constructor: function(args) {
        vslib.log('vs.meapp constructor');
        return declare.safeMixin(this, args);
      },
      log: function(str, doalert) {
        return vslib.log("vs.meapp." + str, doalert);
      },
      loadFCTable: function(fcUrl, fcName) {
        if (fcName == null) {
          fcName = '';
        }
        this.log("loadFCTable");
        return console.debug("loadFCTable. fcUrl: ", arguments);
      },
      createEditorMenu: function() {
        return require(["dijit/Menu", "dijit/MenuItem", "dijit/CheckedMenuItem", "dijit/MenuSeparator", "dijit/PopupMenuItem", "dojo/domReady!"], dojo.hitch(this, function(Menu, MenuItem, CheckedMenuItem, MenuSeparator, PopupMenuItem) {
          var idx, menu, menuButton, sd, self, subdata, tabsmenu, _i, _len;
          this.log("createEditorMenu");
          subdata = [
            {
              label: "Отключающие устройства",
              url: "http://cgis.allgis.org/arcgis/rest/services/edit_Газовая_сеть/FeatureServer/0"
            }, {
              label: "СКЗ",
              url: "http://cgis.allgis.org/arcgis/rest/services/edit_Газовая_сеть/FeatureServer/1"
            }, {
              label: "Газопроводы",
              url: "http://cgis.allgis.org/arcgis/rest/services/edit_Газовая_сеть/FeatureServer/2"
            }, {
              label: "ГРП",
              url: "http://cgis.allgis.org/arcgis/rest/services/edit_Газовая_сеть/FeatureServer/3"
            }
          ];
          self = this;
          tabsmenu = new Menu;
          for (idx = _i = 0, _len = subdata.length; _i < _len; idx = ++_i) {
            sd = subdata[idx];
            tabsmenu.addChild(new MenuItem({
              label: sd.label,
              iconClass: "dijitFolderOpened",
              fClassUrl: sd.url,
              onClick: function() {
                console.log("editor menu, table menuitem onclick. ", arguments);
                return self.loadFCTable(this.fClassUrl, this.label);
              }
            }));
          }
          menu = new dijit.DropDownMenu({
            style: "display: none;"
          });
          menu.addChild(MenuItem({
            label: "Шаблоны",
            iconClass: "dijitIconSearch",
            onClick: function() {
              console.log("editor menu, templates menuitem onclick. ", arguments);
              return navigateStack('editPanel');
            }
          }));
          menu.addChild(new PopupMenuItem({
            label: "Таблицы",
            popup: tabsmenu,
            iconClass: "dijitFolderOpened"
          }));
          menuButton = new dijit.form.DropDownButton({
            label: "Редактирование",
            id: 'editorDropDownButton',
            title: "Шаблоны, таблицы",
            dropDown: menu,
            iconClass: "dijitFolderOpened"
          });
          menuButton.startup;
          return dojo.byId('webmap-toolbar-left').appendChild(menuButton.domNode);
        }));
      }
    };
    vslib.log('meapp dojo/declare vs.meapp');
    return declare("vs.meapp", null, vappFactory);
  });

  console.log("meapp leave");

}).call(this);
